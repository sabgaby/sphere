"use strict";!function(t){function e(t){var e=arguments.length<=1||void 0===arguments[1]?window.location.href:arguments[1];t=t.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),n=a.exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}t(document).ready(function(){function a(){var t={getConfiguration:function(){},init:function(){},render:function(t){console.log("render options: ",t);var e=t.results.hits,a=e.map(function(t){return{title:t.title,logo:t.logo,lat:t.lat,lng:t.lng,country:t.country,city:t.city,address:t.address}});console.log(a),a.forEach(function(t){var e={icon:L.mapbox.marker.icon({"marker-size":"large","marker-symbol":"star","marker-color":"#ff0000"})},a='\n            <div>\n              <div style="text-align:center;">\n                <img src="'+t.logo+'" style="width:80px;"/>\n              </div>\n              <div><b>'+t.title+"</b></div>\n            </div>",n=function(t,n){L.marker([n.latlng[0],n.latlng[1]],e).bindPopup(a).addTo(s)};if(t.lat&&t.lng)r.reverseQuery([t.lat,t.lng],function(t,e){if(t)throw t;n(t,e)});else{if(!t.city&&!t.country)return;var i=[t.address,t.city,t.country].join(", ");r.query(i,function(t,e){if(t)throw t;console.log("mapbox data",e),n(t,e)})}})}};return t}function n(){var t={getConfiguration:function(){},init:function(){},render:function(t){console.log("tableWidget render options: ",t);var e=t.results.hits;p.rows().remove(),p.rows.add(e).draw()}};return t}var i="pk.eyJ1IjoiY3ViZTUiLCJhIjoiY2l2eDltdXRxMDFmczJ1cGRrcTN3M3NiNSJ9.MPdk_yTt0MwRQsll8CnSeg";L.mapbox.accessToken=i;var s=L.mapbox.map("map-container","mapbox.streets").setView([0,0],1),r=L.mapbox.geocoder("mapbox.places"),l="ITI5JHZJM9",o="5828bf68d90dbb0251e6ce88aabe2e07",c="diybiosphere",d='<div class="text-center">No results found matching <strong>{{query}}</strong>.</div>',u='\n\t\t<div class="ui link relaxed items">\n\t\t\t<div class="item">\n\t\t\t  <div class="ui small image">\n\t\t\t    <img class="ui middle aligned" src="{{ logo }}" alt="logo">\n\t\t\t  </div>\n\t\t\t  <div class="content">\n\t\t\t\t<span class="right floated"><i class="marker icon"></i>{{ city }}, {{#country}} {{ country }} {{/country}}</span>\n\t\t\t    <a href="{{url}}" class="header">{{{ _highlightResult.title.value }}}</a>\n\t\t\t    <div class="meta">\n\t\t\t      <span class="cinema"> {{#collection}} {{collection}} {{/collection}}| {{#type-org}} {{ type-org }} {{/type-org}} </span>\n\t\t\t    </div>\n\t\t\t    <div class="description">\n\t\t\t      <p>{{{ _highlightResult.text.value }}}</p>\n\t\t\t    </div>\n\t\t\t    <div class="extra">\n\t\t\t    <div class="ui tiny label">{{ tags }}</div>\n\t\t\t    </div>\n\t\t\t  </div>\n\t\t\t</div>\n\t\t\t<hr>\n\t\t</div>\n    ',g=instantsearch({appId:l,apiKey:o,indexName:c,urlSync:!0});g.addWidget(instantsearch.widgets.searchBox({container:"#search-box",placeholder:"Search for entries..."})),g.addWidget(instantsearch.widgets.currentRefinedValues({container:"#current-refined-values",clearAll:"after",templates:{clearAll:'\n          <button class="ui mini icon red button" data-tooltip="Reset All Filters">\n            <i class="erase icon"></i>\n            Clear\n          </button>'}})),g.addWidget(instantsearch.widgets.stats({container:"#stats-container"})),g.addWidget(instantsearch.widgets.hits({container:"#hits-container",templates:{empty:d,item:u},cssClasses:{root:"ui divided items"},hitsPerPage:3})),g.addWidget(instantsearch.widgets.refinementList({container:"#collection",attributeName:"collection",operator:"or",limit:10,cssClasses:{item:"pad-sides"},templates:{header:"<b>Collection</b>",item:'\n\t\t\t\t\t\t<div class="ui checkbox">\n              <input type="checkbox" name="{{name}}">\n              <label><i class="icon collection-icon" data-collection="{{name}}"></i>{{name}} <div class="ui tiny circular label"> {{count}} </div> </label>\n            </div>\n\t\t\t\t\t\t'}})),g.addWidget(instantsearch.widgets.refinementList({container:"#type-org",attributeName:"type-org",operator:"or",limit:10,templates:{header:"<b>Type of Initiative</b>",item:'\n            <div class="ui checkbox">\n              <input type="checkbox" name="{{name}}">\n              <label>{{name}} <div class="ui tiny circular label"> {{count}} </div> </label>\n            </div>'}})),g.addWidget(instantsearch.widgets.rangeSlider({container:"#start-date",attributeName:"start-date",templates:{header:"<b>Year</b>"}})),g.addWidget(instantsearch.widgets.refinementList({container:"#tags",attributeName:"tags",templates:{header:"<b>Keywords</b>",item:'\n            <div class="ui checkbox">\n              <input type="checkbox" name="{{name}}">\n              <label>{{name}} <div class="ui tiny circular label"> {{count}} </div> </label>\n            </div>'}})),g.addWidget(instantsearch.widgets.pagination({container:"#pagination-container",padding:3,cssClasses:{link:"item",active:"active",disabled:"disabled"}})),g.addWidget(instantsearch.widgets.hitsPerPageSelector({container:"#hits-per-page-selector",cssClasses:{root:"dropdown"},options:[{value:5,label:"5 per page"},{value:10,label:"10 per page"},{value:25,label:"25 per page"},{value:50,label:"50 per page"},{value:100,label:"100 per page"}]})),g.addWidget(a()),g.addWidget(n()),g.start(),g.on("render",function(){t(".collection-icon").each(function(e,a){var n=t(a),i=n.data("collection");"Lab"===i&&n.addClass("lab"),"Group"===i&&n.addClass("users"),"Event"===i&&n.addClass("ticket"),"Other"===i&&n.addClass("umbrella"),"Project"===i&&n.addClass("travel"),"Network"===i&&n.addClass("share alternate"),"Startup"===i&&n.addClass("rocket"),"Incubator"===i&&n.addClass("leaf")})});var p=t("#library-table").DataTable({paging:!1,ordering:!0,dom:'<"top"i<"pull-right"B>>rt<"bottom"ip<"clear">>',buttons:[{extend:"csvHtml5",text:'<i class="fa fa-download"></i> Download as CSV',titleAttr:"CSV",className:"link selectable text-dark"}],columnDefs:[{visible:!0,targets:0,name:"collection",data:"collection"},{visible:!0,targets:1,name:"title",data:"title",render:function(t,e,a){return'<a class="link selectable" href="'+a.url+'">'+t+"</a>"}},{visible:!0,targets:2,name:"start-date",data:"start-date"},{visible:!0,targets:3,name:"host",data:"host",render:function(t){var e="",a="",n="";return null!==t?(e=t.name||"",null!==t.web&&(a='\n                  <a class="link selectable" href="'+t.web+'">\n                    <i class="fa fa-link"></i>\n                  </a>\n                '),null!==t.sphere&&(n='\n                  <a class="link selectable" href="'+t.sphere+'">\n                    <i class="fa fa-external-link"></i>\n                  </a>\n                '),e+" "+a+" "+n):""}},{visible:!0,targets:4,name:"type-org",data:"type-org"},{visible:!0,targets:5,name:"city",data:"city"},{visible:!0,targets:6,name:"country",data:"country"},{visible:!0,targets:7,name:"lastest-commit",data:"last_modified"},{visible:!0,targets:8,name:"tags",data:"tags",render:function(t){return""+t.join(",")}}],language:{thousands:",",zeroRecords:"Nothing found - sorry",info:"Showing _TOTAL_ entries",infoEmpty:"Showing _TOTAL_ entries",infoFiltered:"from _MAX_ total"}});t("#entries tfoot td").each(function(){var e=t(this),a=e.text(),n=a.toLowerCase();e.html('<input id="'+n+'" type="text" placeholder="Search '+a+'" />')}),p.columns().every(function(){var e=this;t("input",this.footer()).on("keyup change",function(){e.search()!==this.value&&e.search(this.value).draw()})});var m=t("#search");m.on("keyup click",function(){p.search(m.val(),!1,!0).draw()}),e("q")&&m.val(e("q")).trigger("keyup")})}($);